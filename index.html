<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Radar semanal Â· Series & PelÃ­culas</title>
  <style>
    :root{
      --bg:#0b0f19; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; --border:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35); --radius:16px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --panel:#ffffff; --text:#111827; --muted:#6b7280; --border:rgba(0,0,0,.08); --shadow: 0 10px 25px rgba(0,0,0,.08);}
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 10% -10%, rgba(96,165,250,.25), transparent 60%),
                  radial-gradient(900px 500px at 90% 0%, rgba(52,211,153,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,0));
      border-bottom:1px solid var(--border);
    }
    .topbar{display:flex; gap:16px; align-items:flex-start; justify-content:space-between; padding:16px 22px}
    h1{margin:0; font-size:18px; letter-spacing:.2px}
    .sub{margin:4px 0 0; color:var(--muted); font-size:13px; line-height:1.3}
    .chips{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .chip{
      padding:8px 10px; border:1px solid var(--border); border-radius:999px;
      background:rgba(255,255,255,.04);
      font-size:12px; color:var(--muted)
    }
    .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin-top:18px}
    .card{
      grid-column: span 12;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{padding:16px 16px 10px; display:flex; justify-content:space-between; gap:12px; align-items:flex-start}
    .hd h2{margin:0; font-size:15px}
    .hd .meta{color:var(--muted); font-size:12px; margin-top:3px}
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--border);
      padding:6px 10px; border-radius:999px;
      color:var(--muted); font-size:12px;
      background:rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .list{padding:0 8px 10px}
    .row{
      display:grid;
      grid-template-columns: 36px 1.4fr 120px;
      gap:10px;
      align-items:center;
      padding:10px 10px;
      border-top:1px solid var(--border);
    }
    .rank{
      width:28px; height:28px; border-radius:10px;
      display:grid; place-items:center;
      background:rgba(96,165,250,.12);
      border:1px solid rgba(96,165,250,.22);
      font-weight:800; font-size:12px;
    }
    .title{display:flex; flex-direction:column; gap:2px}
    .title b{font-size:13px}
    .title span{font-size:12px; color:var(--muted)}
    .score{font-variant-numeric: tabular-nums; text-align:right; font-weight:800}
    .score small{display:block; color:var(--muted); font-weight:600; font-size:11px}
    .err{
      margin-top:14px;
      border:1px solid rgba(176,0,32,.35);
      background: rgba(176,0,32,.08);
      padding:12px 14px;
      border-radius: 12px;
      color: var(--text);
      font-size: 13px;
      display:none;
    }
    @media (min-width: 900px){
      .card.half{grid-column: span 6;}
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div>
        <h1>Radar semanal</h1>
        <div class="sub">Top 5 en EspaÃ±a Â· tÃ­tulo FA (si existe) + gÃ©neros TMDb Â· link a FA/IMDb</div>
      </div>
      <div class="chips">
        <div class="chip">Ãšltima actualizaciÃ³n: <b id="updatedAt">â€”</b></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="err" class="err"></div>

    <div class="grid">
      <section class="card half">
        <div class="hd">
          <div>
            <h2>ðŸŽ¬ PelÃ­culas Â· Top 5</h2>
            <div class="meta">EspaÃ±a Â· plataformas/cines Â· gÃ©nero destacado</div>
          </div>
          <span class="pill">Semana actual</span>
        </div>
        <div class="list" id="moviesList"></div>
      </section>

      <section class="card half">
        <div class="hd">
          <div>
            <h2>ðŸ“º Series Â· Top 5</h2>
            <div class="meta">EspaÃ±a Â· plataformas Â· gÃ©nero destacado</div>
          </div>
          <span class="pill">Semana actual</span>
        </div>
        <div class="list" id="seriesList"></div>
      </section>
    </div>
  </main>

  <script>
    function rowHTML(item){
      const platforms = Array.isArray(item.platforms) && item.platforms.length ? item.platforms.join(" Â· ") : "";
      const where = item.inCinemasES
        ? (platforms ? `Cines Â· ${platforms}` : "Cines")
        : (platforms || item.where || "EspaÃ±a");

      const release = item.releaseES ? ` Â· ES: ${item.releaseES}` : "";

      const genres = Array.isArray(item.genres) && item.genres.length
        ? ` Â· <b>${item.genres.slice(0,3).join(" / ")}</b>`
        : "";

      const href = item.faUrl || item.imdbUrl || null;
      const titleHTML = href
        ? `<a href="${href}" target="_blank" rel="noopener noreferrer" style="color:inherit;text-decoration:none">${item.title ?? "â€”"} â†—</a>`
        : (item.title ?? "â€”");

      const final = (typeof item.final === "number") ? item.final.toFixed(2) : "â€”";

      return `
        <div class="row">
          <div class="rank">${item.rank ?? ""}</div>
          <div class="title">
            <b>${titleHTML}</b>
            <span>${where}${release}${genres}</span>
          </div>
          <div class="score">${final}<small>Final</small></div>
        </div>
      `;
    }

    async function load(){
      const err = document.getElementById("err");
      try{
        const r = await fetch("./data/latest.json?ts=" + Date.now(), { cache:"no-store" });
        if(!r.ok) throw new Error("No puedo cargar data/latest.json (HTTP " + r.status + ")");
        const data = await r.json();

        document.getElementById("updatedAt").textContent = data.updatedAt || "â€”";

        const movies = Array.isArray(data.movies) ? data.movies : [];
        const series = Array.isArray(data.series) ? data.series : [];

        document.getElementById("moviesList").innerHTML =
          movies.length ? movies.map(rowHTML).join("") : `<div class="row"><div></div><div class="title"><b>Sin datos</b><span>Ejecuta el workflow</span></div><div></div></div>`;

        document.getElementById("seriesList").innerHTML =
          series.length ? series.map(rowHTML).join("") : `<div class="row"><div></div><div class="title"><b>Sin datos</b><span>Ejecuta el workflow</span></div><div></div></div>`;

      } catch(e){
        err.style.display = "block";
        err.innerHTML = `<b>Error:</b> ${e.message}<br><span style="color:var(--muted)">Comprueba que existe <code>data/latest.json</code> en GitHub Pages.</span>`;
        document.getElementById("moviesList").innerHTML = "";
        document.getElementById("seriesList").innerHTML = "";
      }
    }

    load();
  </script>
</body>
</html>
