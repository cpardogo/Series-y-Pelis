<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Series Â· Demo enero</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:18px;line-height:1.25}
    h1{margin:0 0 6px}
    .muted{color:#666}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0 10px}
    input,select{padding:8px 10px;border:1px solid #ccc;border-radius:8px}
    table{border-collapse:collapse;width:100%;font-size:13px}
    th,td{border:1px solid #ddd;padding:8px;vertical-align:top}
    th{background:#111;color:#fff;position:sticky;top:0}
    tr:nth-child(even){background:#f6f6f6}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee;font-size:12px}
    .right{text-align:right}
    .center{text-align:center}
    .small{font-size:12px}
    .up{color:#0a7a0a;font-weight:600}
    .down{color:#b00020;font-weight:600}
    .new{color:#0b57d0;font-weight:600}
    .wrap{white-space:normal}
    .note{background:#fff7e6;border:1px solid #ffd18a;padding:10px;border-radius:10px;margin:12px 0}
  </style>
</head>
<body>
  <h1>ðŸ“º Series Â· Demo (enero 2026)</h1>
  <div class="note small">
    <b>IMPORTANTE:</b> esto es una <b>demo</b> con datos ficticios para probar la evoluciÃ³n semana a semana (ranking, Î” vs semana anterior, histÃ³rico).
    No son cifras reales.
  </div>
  <div class="muted small">
    PublicaciÃ³n: mÃ­nimo <b>FilmAffinity + IMDb</b>. RT/Metacritic opcional. <br/>
    Nota Final: pesos ideales FA 25%, IMDb 25%, RTc 12.5%, RTa 12.5%, MCm 12.5%, MCu 12.5%,
    <b>normalizados</b> si faltan fuentes.
  </div>

  <div class="controls">
    <label class="small">Semana:
      <select id="weekSelect"></select>
    </label>
    <input id="q" placeholder="Buscar tÃ­tulo..." />
    <span class="pill" id="lastUpdated"></span>
  </div>

  <table id="tbl">
    <thead>
      <tr>
        <th>#</th>
        <th>TÃ­tulo (temporada)</th>
        <th>Estreno ES</th>
        <th>PaÃ­s</th>
        <th>Idioma</th>
        <th>GÃ©nero</th>
        <th class="center">Netflix</th>
        <th class="center">Prime</th>
        <th class="center">Disney+</th>
        <th class="center">Movistar+</th>
        <th class="right">FA</th>
        <th class="right">IMDb usada</th>
        <th class="right">RT (C/A)</th>
        <th class="right">MC (M/U)</th>
        <th class="center">Cobertura</th>
        <th class="right">Final</th>
        <th class="center">Î” vs prev</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const DATA = [
  {
    week: "2026-01-26",
    items: [
      {id:"s-a", title:"Serie A", season:"T1", release_es:"2026-01-10", country:"EE. UU.", language:"InglÃ©s",
       genre:"AcciÃ³n / Thriller", platforms:{netflix:true, prime:false, disney:false, movistar:false},
       ratings:{fa:7.2, imdb_used:7.6, rt_crit:91, rt_aud:86, mc_meta:78, mc_user:7.5}},
      {id:"s-b", title:"Serie B", season:"T2", release_es:"2026-01-11", country:"EspaÃ±a", language:"EspaÃ±ol",
       genre:"Crimen / Policial", platforms:{netflix:false, prime:false, disney:false, movistar:true},
       ratings:{fa:6.8, imdb_used:7.0, rt_crit:null, rt_aud:null, mc_meta:null, mc_user:null}},
      {id:"s-c", title:"Serie C", season:"T1", release_es:"2026-01-12", country:"Reino Unido", language:"InglÃ©s",
       genre:"Drama", platforms:{netflix:false, prime:true, disney:false, movistar:false},
       ratings:{fa:6.9, imdb_used:6.7, rt_crit:83, rt_aud:74, mc_meta:null, mc_user:null}}
    ]
  },
  {
    week: "2026-01-19",
    items: [
      {id:"s-a", title:"Serie A", season:"T1", release_es:"2026-01-10", country:"EE. UU.", language:"InglÃ©s",
       genre:"AcciÃ³n / Thriller", platforms:{netflix:true, prime:false, disney:false, movistar:false},
       ratings:{fa:7.1, imdb_used:7.5, rt_crit:90, rt_aud:85, mc_meta:77, mc_user:7.4}},
      {id:"s-b", title:"Serie B", season:"T2", release_es:"2026-01-11", country:"EspaÃ±a", language:"EspaÃ±ol",
       genre:"Crimen / Policial", platforms:{netflix:false, prime:false, disney:false, movistar:true},
       ratings:{fa:6.7, imdb_used:6.9, rt_crit:null, rt_aud:null, mc_meta:null, mc_user:null}},
      {id:"s-d", title:"Serie D", season:"T1", release_es:"2026-01-05", country:"Alemania", language:"AlemÃ¡n",
       genre:"Thriller / Espionaje", platforms:{netflix:true, prime:false, disney:false, movistar:false},
       ratings:{fa:6.4, imdb_used:7.1, rt_crit:79, rt_aud:81, mc_meta:68, mc_user:7.0}}
    ]
  },
  {
    week: "2026-01-12",
    items: [
      {id:"s-a", title:"Serie A", season:"T1", release_es:"2026-01-10", country:"EE. UU.", language:"InglÃ©s",
       genre:"AcciÃ³n / Thriller", platforms:{netflix:true, prime:false, disney:false, movistar:false},
       ratings:{fa:7.0, imdb_used:7.4, rt_crit:88, rt_aud:83, mc_meta:76, mc_user:7.3}},
      {id:"s-d", title:"Serie D", season:"T1", release_es:"2026-01-05", country:"Alemania", language:"AlemÃ¡n",
       genre:"Thriller / Espionaje", platforms:{netflix:true, prime:false, disney:false, movistar:false},
       ratings:{fa:6.3, imdb_used:7.0, rt_crit:78, rt_aud:80, mc_meta:67, mc_user:6.9}}
    ]
  }
];

const IDEAL_WEIGHTS = { fa:0.25, imdb:0.25, rt_crit:0.125, rt_aud:0.125, mc_meta:0.125, mc_user:0.125 };

function to10_rt(x){ return (typeof x==="number") ? (x/10) : null; }
function to10_mcmeta(x){ return (typeof x==="number") ? (x/10) : null; }

function computeFinal(r){
  if(typeof r.fa!=="number" || typeof r.imdb_used!=="number") return null;

  const mapped = {
    fa: r.fa,
    imdb: r.imdb_used,
    rt_crit: to10_rt(r.rt_crit),
    rt_aud: to10_rt(r.rt_aud),
    mc_meta: to10_mcmeta(r.mc_meta),
    mc_user: (typeof r.mc_user==="number") ? r.mc_user : null
  };

  let wsum = 0;
  const available = [];
  for(const k in IDEAL_WEIGHTS){
    if(mapped[k] !== null && mapped[k] !== undefined){
      wsum += IDEAL_WEIGHTS[k];
      available.push(k);
    }
  }

  let total = 0;
  for(const k of available){
    total += (IDEAL_WEIGHTS[k]/wsum) * mapped[k];
  }
  return Math.round(total*100)/100;
}

function coverage(r){
  const fields = ["fa","imdb_used","rt_crit","rt_aud","mc_meta","mc_user"];
  let have = 0;
  for(const f of fields){ if(typeof r[f] === "number") have++; }
  return `${have}/6`;
}

function boolToYes(b){ return b ? "SÃ­" : "No"; }

function setWeekOptions(){
  const sel = document.getElementById("weekSelect");
  sel.innerHTML = "";
  DATA.forEach((w, idx) => {
    const opt = document.createElement("option");
    opt.value = idx;
    opt.textContent = w.week;
    sel.appendChild(opt);
  });
  sel.value = "0";
}

function render(){
  const idx = parseInt(document.getElementById("weekSelect").value || "0", 10);
  const current = DATA[idx];
  const prev = DATA[idx+1]?.items || [];
  const prevMap = new Map(prev.map(x => [x.id, computeFinal(x.ratings)]));

  document.getElementById("lastUpdated").textContent = `Semana: ${current.week}`;

  const tbody = document.querySelector("#tbl tbody");
  tbody.innerHTML = "";

  const q = (document.getElementById("q").value || "").toLowerCase().trim();

  const items = current.items
    .map(x => ({...x, final: computeFinal(x.ratings)}))
    .filter(x => x.final !== null)
    .sort((a,b)=> b.final - a.final)
    .filter(x => !q || (`${x.title} ${x.season}`.toLowerCase().includes(q)));

  items.forEach((x, i) => {
    const pr = prevMap.get(x.id);
    let delta = "";
    if(typeof pr === "number"){
      const d = Math.round((x.final - pr)*100)/100;
      delta = d===0 ? "0" : (d>0 ? `â–² ${d}` : `â–¼ ${Math.abs(d)}`);
    } else if(DATA[idx+1]){
      delta = "NEW";
    } else {
      delta = "â€”";
    }
    const deltaClass = delta.startsWith("â–²") ? "up" : delta.startsWith("â–¼") ? "down" : delta==="NEW" ? "new" : "";

    const rt = (typeof x.ratings.rt_crit==="number" && typeof x.ratings.rt_aud==="number")
      ? `${x.ratings.rt_crit}% / ${x.ratings.rt_aud}%` : "N/D";
    const mc = (typeof x.ratings.mc_meta==="number" && typeof x.ratings.mc_user==="number")
      ? `${x.ratings.mc_meta} / ${x.ratings.mc_user}` : "N/D";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="center">${i+1}</td>
      <td class="wrap"><b>${x.title}</b> <span class="muted">(${x.season})</span></td>
      <td>${x.release_es}</td>
      <td>${x.country}</td>
      <td>${x.language}</td>
      <td class="wrap">${x.genre}</td>
      <td class="center">${boolToYes(x.platforms.netflix)}</td>
      <td class="center">${boolToYes(x.platforms.prime)}</td>
      <td class="center">${boolToYes(x.platforms.disney)}</td>
      <td class="center">${boolToYes(x.platforms.movistar)}</td>
      <td class="right">${x.ratings.fa.toFixed(1)}</td>
      <td class="right">${x.ratings.imdb_used.toFixed(1)}</td>
      <td class="right">${rt}</td>
      <td class="right">${mc}</td>
      <td class="center">${coverage(x.ratings)}</td>
      <td class="right"><b>${x.final.toFixed(2)}</b></td>
      <td class="center ${deltaClass}">${delta}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("q").addEventListener("input", render);
document.getElementById("weekSelect").addEventListener("change", render);
setWeekOptions();
render();
</script>
</body>
</html>
